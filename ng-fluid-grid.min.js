angular.module("ngFluidGrid",[]).controller("FluidGridController",["$scope","$attrs","$element","$window",function(a,b,c){this.blocks=[],this.addBlock=function(a){this.blocks.push(a),a.$on("$destroy",function(){this.removeBlock(a)}.bind(this))},this.removeBlock=function(a){var b=this.blocks.indexOf(a);-1!==b&&this.blocks.splice(b,1)},this.getTotalBlocks=function(){return this.blocks.length},this.getGridSize=function(){return{width:+c[0].clientWidth,height:+c[0].clientHeight}},this.getBlockMinWidth=function(){return angular.isDefined(a.blockMinWidth)?a.blockMinWidth:400},this.getBlockMinHeight=function(){return angular.isDefined(a.blockMinHeight)?a.blockMinHeight:400},this.getBlockVerticalMargin=function(){return angular.isDefined(a.blockVerticalMargin)?a.blockVerticalMargin:400},this.getBlockHorizontalMargin=function(){return angular.isDefined(a.blockHorizontalMargin)?a.blockHorizontalMargin:400}}]).directive("fluidGrid",["$window","$timeout",function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"FluidGridController",template:'<div class="fluid-grid" ng-transclude></div>',scope:{blockMinWidth:"@",blockMinHeight:"@",blockVerticalMargin:"@",blockHorizontalMargin:"@"}}}]).directive("fluidGridBlock",["$window",function(a){return{restrict:"EA",require:"^fluidGrid",transclude:!0,replace:!0,template:'<div class="fluid-grid-block" style="float: left; width: {{blockWidth}}; height: {{blockHeight}};" ng-transclude></div>',link:function(b,c,d,e){e.addBlock(b);var f=e.getBlockMinWidth(),g=e.getBlockMinHeight(),h=e.getBlockVerticalMargin(),i=e.getBlockHorizontalMargin(),j=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)}.bind(b),k=function(a,b,c){for(var d=c,e=1;b.width/d<+f;)e++,d=Math.ceil(c/e);var j=b.width/d,k=Math.max(b.height/e,g);a.blockWidth=j-i+"px",a.blockHeight=k-h+"px"};b.$parent.$watch("blocks",function(){angular.element(a).triggerHandler("resize")},!0),b.$on("$destroy",function(){angular.element(a).triggerHandler("resize")}.bind(this)),angular.element(a).on("resize",function(){j(function(){k(b,e.getGridSize(),e.getTotalBlocks())})})}}}]);